# 피부과 예약 관리 시스템 백엔드 API - 기술 요구사항

## 🛠️ 필수 기술 스택

본 과제는 다음 기술 스택을 사용하여 구현해 주시기 바랍니다:

- **Python 3.11+** - 프로그래밍 언어
- **FastAPI** - 웹 프레임워크
- **Uv** - 패키지 관리 및 프로젝트 관리 도구
- **MySQL, PostgreSQL 중 택 1** - 관계형 데이터베이스
- **Docker Compose** - 멀티 컨테이너 관리

위 필수 기술 외 추가 라이브러리 및 도구는 자유롭게 선택하여 사용하실 수 있습니다. (예: ORM, 마이그레이션 도구, 검증 라이브러리 등)

---

## 📐 필수 구현 사항

### 1. 아키텍처 - 멀티 모듈 프로젝트

본 과제는 **마이크로서비스 아키텍처**의 간소화된 형태를 구현합니다. 하나의 저장소에서 두 개의 독립적인 API 모듈로 구성하고, 단일 진입점(Gateway)으로 통합해 주시기 바랍니다.

#### 1-1. Patient API - 환자 예약 서비스
**목적**: 환자가 사용하는 예약 관련 기능을 제공합니다.

- 주요 기능: 예약 생성, 조회, 취소 등 고객 중심 기능
- 엔드포인트 prefix: `/api/v1/patient/*`
- 포트: 8001 (내부 전용, 외부에서 직접 접근 불가)

#### 1-2. Admin API - 예약 관리 서비스
**목적**: 관리자가 사용하는 병원 운영 및 관리 기능을 제공합니다.

- 주요 기능: 의사 정보 관리, 진료 시간 및 예약 현황 조회, 상태 관리 등
- 엔드포인트 prefix: `/api/v1/admin/*`
- 포트: 8002 (내부 전용, 외부에서 직접 접근 불가)

#### 1-3. API Gateway - 단일 진입점
**목적**: 모든 클라이언트 요청을 단일 진입점으로 받아 적절한 서비스로 라우팅합니다.

- 클라이언트는 `http://localhost:8000`로 모든 서비스에 접근
- Gateway는 경로(`/api/v1/patient/*`, `/api/v1/admin/*`)에 따라 요청을 해당 API 모듈로 프록시/라우팅
- 포트: 8000 (외부 접근 가능)

---

### 2. 데이터 모델

다음 엔티티들을 데이터베이스에 설계해 주시기 바랍니다. 각 모델의 필수 필드는 아래와 같으며, 필요에 따라 추가 필드를 자유롭게 설계하실 수 있습니다.

#### 2-1. 의사 정보 (Doctor)
- **필수 필드**: 이름, 진료과
- **설명**: 병원에 근무하는 의사의 기본 정보

#### 2-2. 진료 항목 (Treatment)
- **필수 필드**: 시술명, 소요시간(30분 단위), 가격, 설명
- **설명**: 병원에서 제공하는 진료/시술 메뉴

#### 2-3. 병원 시간대별 인원 설정 (HospitalSlot)
- **필수 필드**: 시간대_시작, 시간대_종료(30분 단위), 최대_인원수
- **설명**: 병원 전체의 시간대별 동시 수용 가능 인원. 모든 날짜에 동일하게 적용됩니다.
- **예시**: 시간대_시작: 10:00, 시간대_종료: 10:30, 최대_인원수: 3

#### 2-4. 환자 정보 (Patient)
- **필수 필드**: 이름, 연락처
- **설명**: 예약을 진행하는 환자의 기본 정보

#### 2-5. 예약 정보 (Appointment)
- **필수 필드**: 환자(FK), 의사(FK), 진료 항목(FK), 예약_시작일시, 상태, 초진/재진 구분, 메모
- **예약 상태**: 예약대기, 확정, 완료, 취소
- **초진/재진**: 예약 생성 시 자동 판단되어 저장
- **예약 종료 시간**: 예약_시작일시 + 진료항목의 소요시간으로 계산됩니다. 별도 필드로 저장할지는 자유롭게 선택 가능합니다.

---

#### 병원 운영 시간 관리

병원 운영 시간(영업시간, 점심시간 등)은 구현 방법을 자유롭게 선택하실 수 있습니다:
- 환경 설정 파일이나 상수로 관리
- 별도 테이블로 관리
- 기타 적절한 방법

**예시**: 월-금 09:00~18:00 (점심시간 12:00~13:00)

> **참고**: 외래키 관계, 인덱스 설정 등은 성능을 고려하여 적절히 설계해 주시기 바랍니다.

---

### 3. Patient API - 필수 엔드포인트

환자가 사용하는 API로, 다음 기능을 구현해 주시기 바랍니다:

#### 3-1. 의사 목록 조회
- **기능**: 병원의 전체 의사 목록을 조회합니다.
- **옵션**: 진료과로 필터링 가능

#### 3-2. 예약 가능 시간 조회
- **기능**: 특정 의사의 예약 가능한 시간대를 조회합니다.
- **요구사항**:
  - 병원 운영 시간 내의 예약 가능 시간대만 노출
  - 선택한 날짜 기준으로 15분 간격 시간대 제공
  - 이미 예약된 시간, 병원 수용 인원 초과 시간은 제외

#### 3-3. 예약 생성
- **기능**: 새로운 예약을 생성합니다.
- **요구사항**:
  - 중복 예약 방지 로직 구현 (동일 의사에게 동일 시간대 중복 불가)
  - 병원 시간대별 최대 인원수 제한 검증
  - 초진/재진 자동 판단 및 저장

- **시간대 검증 규칙**:
  - 예약 시작 시간부터 종료 시간까지 걸치는 모든 30분 슬롯을 확인
  - 모든 해당 슬롯에 수용 인원 여유가 있어야 예약 가능
  - 예시: 10:15~10:45 예약(30분)은 10:00~10:30, 10:30~11:00 슬롯 모두 확인 필요

#### 3-4. 예약 조회
- **기능**: 환자 본인의 예약 목록을 조회합니다.
- **요구사항**: 본인의 예약만 조회 가능

#### 3-5. 예약 취소
- **기능**: 예약을 취소 상태로 변경합니다.

---

### 4. Admin API - 필수 엔드포인트

관리자가 사용하는 API로, 다음 기능을 구현해 주시기 바랍니다:

#### 4-1. 의사 정보 CRUD
- 의사 정보의 생성(Create), 조회(Read), 수정(Update), 삭제(Delete) 기능

#### 4-2. 병원 시간대별 진료 인원 관리
- **기능**: HospitalSlot 데이터를 관리하는 기능
- 구현 방법은 자유롭게 선택 가능합니다:
  - CRUD 엔드포인트로 구현
  - 설정용 단일 엔드포인트로 구현
  - 기타 적절한 방법
- **예시**: 10:00~10:30 시간대에 최대 3명으로 설정/수정

#### 4-3. 진료 항목 CRUD
- 진료 항목의 생성, 조회, 수정, 삭제 기능

#### 4-4. 전체 예약 조회
- **기능**: 모든 예약을 조회합니다.
- **요구사항**: 날짜, 의사, 상태 등 다양한 조건으로 필터링 가능

#### 4-5. 예약 상태 수정
- **기능**: 예약의 상태를 변경합니다.
- **가능한 상태**: 예약대기 → 확정 → 완료 또는 취소

#### 4-6. 예약 통계
- **기능**: 다양한 통계 정보를 제공합니다.
- **필수 통계 항목**:
  - 상태별 예약 건수
  - 일별 예약 현황
  - 시간대별 예약 현황
  - 초진/재진 비율

---

### 5. 환경 분리 및 테스트 (필수)

실무 환경을 고려하여 개발 환경과 테스트 환경을 분리해 주시기 바랍니다.

#### 5-1. 환경 분리
- `development`, `test` 환경을 구분하여 설정 파일 분리
- 환경별로 다른 데이터베이스 연결 정보 사용

#### 5-2. 테스트 코드
- `pytest`를 이용한 통합 테스트 코드 작성
- **요구사항**: 각 엔드포인트별 최소 2개 이상의 시나리오 테스트
  - 정상 케이스
  - 예외 케이스 (검증 실패, 중복 등)

#### 5-3. 테스트 환경
- test 환경은 in-memory DB(SQLite 등) 또는 별도 테스트 DB 사용
- 운영 데이터와 분리하여 안전하게 테스트

#### 5-4. 테스트 실행
- `pytest` 명령어 한 번으로 모든 테스트 실행 가능하도록 구성

---

### 6. Docker Compose (필수)

한 번의 명령어로 전체 시스템을 실행할 수 있도록 Docker Compose를 구성해 주시기 바랍니다.

#### 6-1. 필수 컨테이너 구성
- **API Gateway (FastAPI)** - 포트 8000 (외부 노출)
- **Patient API (FastAPI)** - 포트 8001 (내부 전용)
- **Admin API (FastAPI)** - 포트 8002 (내부 전용)
- **관계형 데이터베이스** - MySQL 또는 PostgreSQL (각 API에서 공유)

#### 6-2. 데이터베이스 초기화
- 데이터베이스 마이그레이션 자동화
  - init.sql 스크립트 사용
  - 또는 Alembic 같은 마이그레이션 도구 활용
- 컨테이너 시작 시 자동으로 스키마 생성

#### 6-3. 실행 요구사항
- `docker-compose up` 명령어 한 번으로 모든 서비스 실행 가능
- 서비스 간 의존성 관계 적절히 설정 (예: DB가 먼저 시작된 후 API 시작)

---

## 🤖 AI 활용 방식 작성 (필수)

과제 수행 중 AI 도구(ChatGPT, GitHub Copilot, Claude 등)를 활용하신 경우, README.md 또는 별도 문서에 다음 내용을 포함하여 작성해 주시기 바랍니다:
- 어떤 AI 도구를 사용했는지
- 어떤 부분에서 AI를 활용했는지 (예: 코드 생성, 디버깅, 아키텍처 설계 등)
- AI를 활용하면서 느낀 점이나 개선한 점

> AI 활용 자체는 감점 요인이 아님을 전해드립니다.